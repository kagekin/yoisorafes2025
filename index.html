<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YOISORA FES 2025 ‰ΩúÊà¶‰ºöË≠∞</title>

    <!-- OGP Tags for Social Sharing -->
    <meta property="og:title" content="YOISORA FES 2025 ‰ΩúÊà¶‰ºöË≠∞">
    <meta property="og:description" content="„Åì„ÅÆÂ§è„Åå„ÄÅÈùíÊò•„Åå„ÄÅÁµÇ„Çè„Çä„Åæ„Åõ„Çì„Çà„ÅÜ„Å´„ÄÇÊúÄÈ´ò„ÅÆ‚ÄúÂÖ±ÁäØ‚Äù„Éï„Çß„Çπ„ÄÅË®àÁîªÂßãÂãïÔºÅ">
    <meta property="og:image" content="https://i.imgur.com/Xh4eR6w.png">
    <meta property="og:url" content="https://yoisorafes.studio.site/">
    <meta name="twitter:card" content="summary_large_image">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <!-- GSAP and Tone.js for animations and sound -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
            overflow: hidden;
        }
        .chat-bubble::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
        }
        .chat-bubble-left::before {
            border-width: 8px 12px 8px 0;
            border-color: transparent #ffffff transparent transparent;
            left: -12px;
            top: 12px;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .background-image {
            background-image: url('https://i.imgur.com/Xh4eR6w.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .explosion-emoji {
            position: absolute;
            font-size: 24px;
            user-select: none;
            pointer-events: none;
        }
        .action-button-container {
            position: fixed;
            top: 50%;
            right: 0.5rem; /* Adjusted for smaller screens */
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            z-index: 100;
        }
        .action-button {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(4px);
            border-radius: 9999px;
            width: 44px; /* Adjusted for smaller screens */
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease-in-out;
        }
        .action-button:hover {
            transform: scale(1.1);
            background-color: white;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }
        .side-panel-container {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            z-index: 150;
            display: flex;
            align-items: center;
            padding-left: 1rem;
            pointer-events: none; /* Pass clicks through container */
        }
        .side-panel-content {
            pointer-events: auto; /* Enable clicks on content */
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-height: 90vh;
        }
        .episode-nav {
            width: 240px; /* Fixed width */
        }
    </style>
</head>
<body class="background-image bg-gray-900 flex items-center justify-center min-h-screen">

    <!-- Episode Navigation Panel (for desktop) -->
    <div id="side-panel-container" class="side-panel-container hidden md:flex">
        <div class="side-panel-content">
            <!-- Episode Navigation -->
            <div class="episode-nav bg-slate-800/50 backdrop-blur-sm p-4 rounded-2xl shadow-2xl overflow-y-auto">
                <h2 class="text-white font-bold text-lg mb-4 text-center border-b border-slate-700 pb-2">„Ç®„Éî„ÇΩ„Éº„Éâ</h2>
                <div id="episode-list" class="space-y-2">
                    <!-- Episodes will be dynamically inserted here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Episode Toggle Button (for mobile) -->
    <button id="episode-toggle-button" class="md:hidden fixed top-4 left-4 z-[160] bg-white/80 backdrop-blur-sm p-3 rounded-full shadow-lg">
        <svg class="w-6 h-6 text-gray-800" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" /></svg>
    </button>


    <!-- Main Chat UI -->
    <div class="w-full max-w-md mx-auto bg-slate-800/50 backdrop-blur-sm rounded-2xl shadow-2xl flex flex-col h-[90vh] max-h-[800px]">
        <header class="bg-slate-900/80 text-white p-3 flex items-center justify-between rounded-t-2xl shadow-lg">
            <div class="flex items-center">
                <h1 id="chat-title" class="font-bold text-lg ml-2">„É®„Ç§„ÇΩ„É©„Éï„Çß„Çπ‰ΩúÊà¶‰ºöË≠∞ (19)</h1>
            </div>
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
            </div>
        </header>

        <main id="chat-area" class="flex-1 p-4 overflow-y-auto space-y-4">
            <!-- Messages and logo will be appended here -->
        </main>

        <footer id="choice-area" class="p-4 border-t border-slate-700/50">
            <div id="choices" class="grid grid-cols-1 gap-2">
                <!-- Choices will be appended here -->
            </div>
        </footer>
    </div>

    <!-- Floating Action Buttons -->
    <div class="action-button-container">
        <button onclick="shareOnX()" class="action-button" title="X„Åß„Ç∑„Çß„Ç¢„Åô„Çã">
            <svg class="w-5 h-5 text-gray-800" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></svg>
        </button>
        <button id="open-modal-button" class="action-button" title="Ê°úÂÖé„Éï„É´„Ç¨„Å´„Å§„ÅÑ„Å¶">
            <img src="https://pbs.twimg.com/profile_images/1942616127693111296/KTgfARQ2_400x400.jpg" class="w-7 h-7 rounded-full object-cover">
        </button>
    </div>

    <!-- Oto Furuga Profile Modal -->
    <div id="profile-modal" class="modal-overlay hidden">
        <div class="bg-white rounded-2xl shadow-2xl w-11/12 max-w-sm p-6 relative text-gray-800 fade-in">
            <button id="close-modal-button" class="absolute top-3 right-3 text-gray-500 hover:text-gray-800">
                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <div class="text-center">
                <img src="https://pbs.twimg.com/profile_images/1942616127693111296/KTgfARQ2_400x400.jpg" class="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-pink-300 shadow-lg">
                <h2 class="text-2xl font-bold">Ê°úÂÖé„Éï„É´„Ç¨</h2>
                <p class="text-sm text-pink-500 font-semibold">„Ç§„Éô„É≥„Éà‰∏ªÂÇ¨ / „Éê„Éº„ÉÅ„É£„É´„Ç¢„Ç§„Éâ„É´</p>
                <p class="text-xs mt-1 text-gray-500">Project Director</p>
                
                <p class="text-sm mt-4 text-left p-4 bg-pink-50 rounded-lg">
                    „Äå„Åì„ÅÆ„Éï„Çß„ÇπÔΩ•ÔΩ•ÔΩ•„Ç®„É¢„ÅÑ!!„Äç„Å£„Å¶Ë®Ä„Çè„Åõ„Åü„ÅÑ„ÄÇ<br>
                    „Éê„Éº„ÉÅ„É£„É´„Ç¢„Ç§„Éâ„É´„Å®„Åó„Å¶Ê¥ªÂãï„Åô„ÇãÂÇç„Çâ„ÄÅËá™„Çâ‰ºÅÁîª„ÉªÊºîÂá∫„ÇíÊâã„Åå„Åë„Çã„Éû„É´„ÉÅ„ÇØ„É™„Ç®„Ç§„Çø„Éº„ÄÇ„É°„Çø„Éê„Éº„Çπ„Åß„ÅÆË±äÂØå„Å™„Ç§„Éô„É≥„Éà‰∏ªÂÇ¨ÁµåÈ®ì„ÇíÊ¥ª„Åã„Åó„ÄÅÈùíÊò•„Å®Ê≤°ÂÖ•ÊÑü„ÅÇ„Åµ„Çå„Çã‰∏ÄÂ§ú„Çí„Éó„É≠„Éá„É•„Éº„Çπ„Åô„Çã„ÄÇ
                </p>

                <div class="flex gap-4 mt-6">
                    <a href="https://x.com/oto_furuga" target="_blank" class="flex-1 bg-gray-800 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-900 transition flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></svg>
                        X
                    </a>
                    <a href="https://www.youtube.com/@otofuruga" target="_blank" class="flex-1 bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 transition flex items-center justify-center gap-2">
                        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M21.582,6.186c-0.23-0.86-0.908-1.538-1.768-1.768C18.254,4,12,4,12,4S5.746,4,4.186,4.418 c-0.86,0.23-1.538,0.908-1.768,1.768C2,7.746,2,12,2,12s0,4.254,0.418,5.814c0.23,0.86,0.908,1.538,1.768,1.768 C5.746,20,12,20,12,20s6.254,0,7.814-0.418c0.861-0.23,1.538-0.908,1.768-1.768C22,16.254,22,12,22,12S22,7.746,21.582,6.186z M10,15.464V8.536L16,12L10,15.464z"></path></svg>
                        YouTube
                    </a>
                </div>
            </div>
            <!-- Secret button for debug menu -->
            <div id="secret-button" class="absolute bottom-1 right-1 w-8 h-8 cursor-pointer"></div>
        </div>
    </div>

    <script>
        const chatArea = document.getElementById('chat-area');
        const choiceArea = document.getElementById('choice-area');
        const choicesContainer = document.getElementById('choices');
        const profileModal = document.getElementById('profile-modal');
        const openModalButton = document.getElementById('open-modal-button');
        const closeModalButton = document.getElementById('close-modal-button');
        const episodeListContainer = document.getElementById('episode-list');
        const sidePanelContainer = document.getElementById('side-panel-container');
        const episodeToggleButton = document.getElementById('episode-toggle-button');
        const chatTitle = document.getElementById('chat-title');
        const secretButton = document.getElementById('secret-button');


        // Character definitions
        const characters = {
            oto: { name: '„Åä„Å®', avatar: 'https://pbs.twimg.com/profile_images/1942616127693111296/KTgfARQ2_400x400.jpg' },
            akira: { name: '„Ç¢„Ç≠„É©', avatar: 'https://placehold.co/40x40/60a5fa/ffffff?text=A' },
            yui: { name: '„É¶„Ç§', avatar: 'https://placehold.co/40x40/a78bfa/ffffff?text=Y' },
            kawashii: { name: '„Åã„Çè„Åó„ÅÉ', avatar: 'https://pbs.twimg.com/profile_images/1751672844101312512/p2MkkNhA_400x400.jpg' },
            kagekin: { name: '„Ç´„Ç≤„Ç≠„É≥', avatar: 'https://pbs.twimg.com/profile_images/1905651963158835200/M06q-esr_400x400.jpg' },
            kabochashinshi: { name: '„Ç´„Éú„ÉÅ„É£Á¥≥Â£´', avatar: 'https://pbs.twimg.com/profile_images/1775294690612695040/Eu5cuCVh_400x400.jpg' },
            motoji: { name: '„ÇÇ„Å®„Åò', avatar: 'https://i.imgur.com/SgA0O3T.png' },
            susukinitsuki: { name: '„Åô„Åô„Åç„Å´„Å§„Åç', avatar: 'https://i.imgur.com/LemWuFU.png' },
            penguin: { name: '„Å∫„Çì„Åé„ÇìÔºÅ', avatar: 'https://i.imgur.com/h5Rvyxf.png' },
            linda: { name: 'Linda', avatar: 'https://i.imgur.com/C8Xg94r.png' },
            keke: { name: 'Âü∑‰∫ã„Åë„Åë', avatar: 'https://placehold.co/40x40/8f8f8f/ffffff?text=K' },
            hinamy: { name: 'È≠îÂ•≥„Éí„Éä„Éü„Ç£', avatar: 'https://placehold.co/40x40/a355b0/ffffff?text=H' },
            karma: { name: 'KA–ØMA', avatar: 'https://placehold.co/40x40/c53030/ffffff?text=K' },
            eren: { name: '„Ç®„É¨„É≥', avatar: 'https://placehold.co/40x40/718096/ffffff?text=E' },
            kijima: { name: 'Ë≤¥Â≥∂Á§ºÁØÄ', avatar: 'https://placehold.co/40x40/2c5282/ffffff?text=R' },
            kanao: { name: 'ÈáëÂ∞æ', avatar: 'https://placehold.co/40x40/d69e2e/ffffff?text=K' },
            konomi: { name: 'Áê¥Êúõ', avatar: 'https://placehold.co/40x40/9b2c2c/ffffff?text=K' },
            nagisa: { name: 'nagisa', avatar: 'https://placehold.co/40x40/667eea/ffffff?text=N' },
            user: { name: '„ÅÇ„Å™„Åü', avatar: '' }
        };

        // Story Episodes
        const episodes = [
            { id: 1, title: 'Á¨¨ÔºëË©± YOISORA FES„ÇíÂßã„ÇÅ„Çà„ÅÜÔºÅ', releaseDate: '2025-08-10', script: 'ep1_script' },
            { id: 2, title: 'Á¨¨ÔºíË©± Virtual Rock BAND„ÄåSTRiNG5„Äç„Åå„ÇÑ„Å£„Å¶„Åè„ÇãÔºÅ', releaseDate: '2025-08-17', script: 'ep2_script' },
            { id: 3, title: 'Á¨¨ÔºìË©± VR„É≠„ÉÉ„ÇØ„Éê„É≥„Éâ„ÄéPHANTOM„Äè Âá∫ÊºîÔºÅÔºÅ', releaseDate: '2025-08-24', script: 'ep3_script' },
            { id: 4, title: 'Á¨¨ÔºîË©± VTuber„ÅÆ„É≠„ÉÉ„ÇØ„Éê„É≥„Éâ„ÄéLAUTRIV„ÄèÂá∫ÊºîÔºÅÔºÅ', releaseDate: '2025-08-31', script: 'ep4_script' },
            { id: 5, title: 'Á¨¨ÔºïË©± ÂäáÂõ£„ÉÜ„Ç¢„Éâ„É´„ÉÅ„Çß Âá∫ÊºîÔºÅÔºÅ', releaseDate: '2025-09-07', script: 'ep5_script' },
            { id: 6, title: 'Á¨¨ÔºñË©± „ÅÑ„Çà„ÅÑ„ÇàÂßã„Åæ„ÇãYOISORA FESÔºÅÔºÅ', releaseDate: '2025-09-10', script: 'ep6_script' }
        ];

        // Narrative Scripts
        const scripts = {
            ep1_script: [
                { char: 'oto', text: '„Åø„Çì„Å™„ÄÅ„ÅÑ„Çà„ÅÑ„Çà„Å†„Å≠ÔºÅ‰ªäÂπ¥„ÅÆ„É®„Ç§„ÇΩ„É©„Éï„Çß„Çπ„ÄÅÊúÄÈ´ò„ÅÆÂ§è„Å´„Åô„Çã„ÇàÔºÅüî•' },
                { char: 'yui', text: '„Çè„ÉºÔºÅ„Åä„Å®„Å°„ÇÉ„Çì„ÄÅÂæÖ„Å£„Å¶„Åæ„Åó„ÅüÔºÅ‚ú® ‰ªäÂπ¥„ÅØ„Å©„Çì„Å™ÊÑü„Åò„Å´„Å™„Çã„ÅÆÔºü' },
                { char: 'kawashii', text: '‰ø∫„ÅÆÂá∫Áï™„Å†„Å™ÔºÅ„Ç¢„Éº„Éà„ÅØÁàÜÁô∫„Å†ÔºÅ' },
                { char: 'oto', text: '„Åµ„Åµ„Åµ‚Ä¶ ‰ªäÂπ¥„ÅÆ„ÉÜ„Éº„Éû„ÅØ„Äå„Åì„ÅÆÂ§è„Åå„ÄÅÈùíÊò•„Åå„ÄÅÁµÇ„Çè„Çä„Åæ„Åõ„Çì„Çà„ÅÜ„Å´„Äç„ÄÇÂ≠¶Ê†°ÂÖ®‰Ωì„Çí‰Ωø„Å£„Åü„ÄÅ‰∏ÄÂ§úÈôê„Çä„ÅÆ‚ÄúÂÖ±ÁäØ‚Äù„Éï„Çß„Çπ„Å†„ÇàÔºÅ' },
                { char: 'akira', text: '‚ÄúÂÖ±ÁäØ‚Äù„Åã„ÄÇ„ÅÑ„ÅÑÈüø„Åç„Å†„ÄÇÈü≥Ê•Ω„ÇÇ„ÄÅÊúÄÈ´ò„ÅÆ„ÇÑ„Å§„ÇíÁî®ÊÑè„Åó„Å™„ÅÑ„Å®„Å™„ÄÇ' },
                { char: 'kabochashinshi', text: '„ÅÜ„ÇÄÔºÅÈùíÊò•„Å†„Å≠„ÅáÔºÅÁßÅ„ÇÇÊúÄÈ´ò„ÅÆ„Ç¢„Ç§„ÉÜ„É†„Çí‰ªïÂÖ•„Çå„Å¶„Åç„Åü„ÇàÔºÅÂÖâ„Çã„Éñ„É¨„Çπ„É¨„ÉÉ„Éà„Å®„Åã„ÄÅÁâπË£Ω„Çø„Ç™„É´„Å®„Åã‚Ä¶ÔºÅ' },
                { char: 'kagekin', text: '„Éè„É≠„Éº„É≠„ÉºÔºÅ„Ç´„Ç≤„Ç≠„É≥„Å†„Çà„ÉºÔºÅ„Åì„ÅÆ„Éï„Çß„Çπ„ÅåÊàêÂäü„Åó„Åü„Çâ„ÄÅ„Éü„Éº„ÅåÁîüÂæí‰ºöÈï∑„Å´„Å™„Çã„ÅÆ„ÇÇ„Éõ„É©„Éº„Ç∑„Éß„Éº„Å†„Å≠„ÉºÔºÅ' },
                { char: 'susukinitsuki', text: '„Åì„ÅÆ„Éï„Çß„Çπ„ÅÆ„Éá„Ç∂„Ç§„É≥„ÄÅÂ§ïÊöÆ„Çå„Åã„ÇâÂ§úÁ©∫„Å´Â§â„Çè„Çã‰∏ÄÁû¨„ÅÆ„Äå„Ç®„É¢„Äç„ÇíÂÖ®ÈÉ®Ë©∞„ÇÅËæº„Çì„Å†„Åã„ÇâÔºÅ„Åø„Çì„Å™„ÅÆÂøÉ„Å´Âàª„Åæ„Çå„Çã„Å®„ÅÑ„ÅÑ„Å™„ÄÇ' },
                { char: 'motoji', text: '„Åì„ÅÆ„Éï„Çß„Çπ„ÄÅÊúÄÈ´ò„ÅÆ„Ç∑„É£„ÉÉ„Çø„Éº„ÉÅ„É£„É≥„Çπ„Åó„Åã„Å™„ÅÑ‚Ä¶ÔºÅ„Åø„Çì„Å™„ÅÆÈùíÊò•„ÄÅ‰∏ÄÊûöÊÆã„Çâ„Åö„Éï„Ç£„É´„É†„Å´ÁÑº„Åç‰ªò„Åë„Çã„ÇàÔºÅ' },
                { char: 'penguin', text: '„Åä„ÄÅ„ÅäÈÇ™È≠î„Åó„Åæ„Åô‚Ä¶ÔºÅ„Ç¶„ÉÅ„ÄÅ‰ªäÂõû„ÅÆ„Éï„Çß„Çπ„ÅÆË≠¶ÂÇô„Å®„Çµ„Éù„Éº„Éà„ÇíÊãÖÂΩì„Åó„Åæ„Åô„ÄÅ„Å∫„Çì„Åé„ÇìÔºÅ„Åß„ÅôÔºÅ' },
                { char: 'penguin', text: 'Ôºà„Åô„ÄÅ„Åô„ÉºÊßò‚Ä¶ÔºÅÊú¨Áâ©‚Ä¶ÔºÅ„Ç¶„ÉÅ„ÄÅ„Åó„Å£„Åã„ÇäÁöÜ„Åï„Çì„ÅÆÂÆâÂÖ®„ÇíÂÆà„Çä„Åæ„Åô‚Ä¶ÔºÅÔºâ' },
                { char: 'linda', text: 'ÁöÜ„Åï„Çì„ÄÅ„Åì„Çì„Å´„Å°„ÅØ„ÄÇÈ¢®Á¥ÄÂßîÂì°„ÅÆ„É™„É≥„ÉÄ„Åß„Åô„ÄÇ„Åì„ÅÆ„Éï„Çß„Çπ„Åß„ÅØË≠¶ÂÇô„Çπ„Çø„ÉÉ„Éï„Å®„Åó„Å¶„ÄÅÁöÜ„Åï„Çì„ÅÆÂÆâÂÖ®„ÇíÁ¨¨‰∏Ä„Å´Âä™„ÇÅ„Åï„Åõ„Å¶„ÅÑ„Åü„Å†„Åç„Åæ„Åô„ÄÇ' },
                { char: 'oto', text: '„Åø„Çì„Å™ÊèÉ„Å£„Åü„Å≠ÔºÅÂøÉÂº∑„ÅÑ„Å™„ÄúÔºÅ„Å®„Å´„Åã„Åè„ÄÅ„Åø„Çì„Å™„Å´„ÅäÈ°ò„ÅÑ„Åå„ÅÇ„Çã„Çì„Å†„Åë„Å©‚Ä¶' },
                {
                    char: 'oto',
                    text: '„Åæ„Åö„ÅØ„ÄÅ„É°„Ç§„É≥„Çπ„ÉÜ„Éº„Ç∏„Å´„Å™„Çã„Éó„Éº„É´„Çµ„Ç§„Éâ„ÅÆÈ£æ„Çä‰ªò„Åë„Åã„ÇâÔºÅ„Å©„Çì„Å™Èõ∞Âõ≤Ê∞ó„Å´„Åó„Åü„ÅÑÔºü',
                    choices: [
                        { text: '„Ç≠„É©„Ç≠„É©„Åß„Ç®„É¢„ÅÑÊÑü„ÅòÔºÅ‚ú®', next: 'emo_choice' },
                        { text: 'Êâã‰Ωú„ÇäÊÑü„ÅÆ„ÅÇ„ÇãÁßòÂØÜÂü∫Âú∞„Åø„Åü„ÅÑ„Å´ÔºÅüèïÔ∏è', next: 'base_choice' },
                        { text: '‰ºùË™¨„ÅÆ„É≠„ÉÉ„ÇØ„Éï„Çß„Çπ„Å£„ÅΩ„Åè„ÄÅ„Ç´„ÉÉ„Ç≥„Çà„ÅèÔºÅüé∏', next: 'rock_choice' }
                    ]
                }
            ],
            ep2_script: [
                { char: 'akira', text: '„Çπ„ÉÜ„Éº„Ç∏„ÅÆÈ£æ„Çä‰ªò„Åë„ÇÇÊ±∫„Åæ„Å£„Åü„Åó„ÄÅÊ¨°„ÅØÈü≥Ê•Ω„Å†„Å™„ÄÇ„ÇÇ„Å£„Å®„Åì„ÅÜ„ÄÅ„Ç¨„ÉÑ„É≥„Å®„Åè„Çã„É≠„ÉÉ„ÇØ„Å™Èü≥„ÅåÊ¨≤„Åó„ÅÑ„ÄÇ' },
                { char: 'motoji', text: '„Å™„Çì„Å¶„Åì„Å£„Åü„ÅÑ„ÄÅ„Åù„Çå„Å™„ÇâSTRiNG5„Åï„Çì„Å™„Çì„Å¶„Å©„ÅÜ„Åß„ÅôÔºÅÔºüÁîüÊºîÂ•è„ÅåÊú¨ÂΩì„Å´ÊúÄÈ´ò„Åß‚Ä¶ÊøÄÊé®„Åó„Åè„Çì„Åß„ÅôÔºÅ' },
                { char: 'yui', text: 'STRiNG5„Åï„ÇìÔºÅÁü•„Å£„Å¶„ÇãÔºÅËìºÊùæ„Åø„Åä„Åï„Çì„ÅÆ„ÇÆ„Çø„Éº„ÄÅ„Åã„Å£„Åì„ÅÑ„ÅÑ„Çà„Å≠ÔºÅ' },
                { char: 'oto', text: '„ÅÑ„ÅÑ„Å≠ÔºÅYouTube„ÅÇ„Å£„Åü„ÇàÔºÅ„Åø„Çì„Å™„ÇÇË¶ã„Å¶„Åø„Å¶ÔºÅ\nhttps://www.youtube.com/@STRINGSfrom2024' },
                { 
                    char: 'penguin', 
                    text: '„Çè„ÅÇ„ÄÅ„Åô„Åî„ÅÑ„Åß„Åô„Å≠ÔºÅ„Éï„Çß„Çπ„Åå„ÇÇ„Å£„Å®Áõõ„Çä‰∏ä„Åå„Çä„Åù„ÅÜ„Åß„ÅôÔºÅ',
                    choices: [
                        { text: 'ÁîüÊºîÂ•è„ÄÅÁµ∂ÂØæÁõõ„Çä‰∏ä„Åå„ÇãÔºÅ', next: 'ep2_continue' },
                        { text: '„Åì„ÅÆ„Éê„É≥„Éâ„ÄÅÊ∞ó„Å´„Å™„ÇãÔºÅ', next: 'ep2_continue' }
                    ]
                }
            ],
            ep3_script: [
                { char: 'oto', text: 'STRiNG5„Åï„Çì„ÄÅÊ±∫„Åæ„Å£„Å¶Â¨â„Åó„ÅÑÔºÅ„ÇÇ„ÅÜ‰∏ÄÁµÑ„ÄÅÈùíÊò•„Å£„Å¶ÊÑü„Åò„ÅÆÁÜ±„ÅÑ„Éê„É≥„Éâ„ÇÇÂëº„Å≥„Åü„ÅÑ„Å™„ÉºÔºÅ' },
                { char: 'oto', text: 'VR„É≠„ÉÉ„ÇØ„Éê„É≥„Éâ„ÅÆ„ÄéPHANTOM„Äè„Åï„Çì„ÅØ„Å©„ÅÜ„Åã„Å™Ôºü' },
                { 
                    char: 'akira', 
                    text: 'PHANTOM„Åã„ÄÅ„ÅÑ„ÅÑ„Å™„ÄÇÂΩº„Çâ„ÅÆÈü≥„ÅØÈ≠Ç„Å´Èüø„Åè„ÄÇ„Åì„ÅÆ„Éï„Çß„Çπ„Å´„Å¥„Å£„Åü„Çä„Å†„ÄÇ',
                    choices: [
                        { text: 'ÁÜ±„ÅÑ„Éê„É≥„Éâ„ÄÅ„ÅÑ„ÅÑ„Å≠ÔºÅ', next: 'ep3_continue' },
                        { text: '„Åú„Å≤Âëº„Çì„Åß„Åª„Åó„ÅÑÔºÅ', next: 'ep3_continue' }
                    ]
                },
            ],
            ep4_script: [
                { char: 'oto', text: '„Å≠„Åà„Å≠„Åà„Åø„Çì„Å™„ÄÅÂÆü„ÅØ‚Ä¶„Åø„Çì„Å™„Å´ÂÜÖÁ∑í„ÅßÂãï„ÅÑ„Å¶„Åü„Çì„Å†„Åë„Å©‚Ä¶„Çµ„Éó„É©„Ç§„Ç∫„Åå„ÅÇ„Çã„Çì„Å†ÔºÅ' },
                { char: 'yui', text: '„Åà„ÄÅ„Å™„Å´„Å™„Å´ÔºÅÔºü' },
                { char: 'oto', text: 'VTuber„Éê„É≥„Éâ„ÅÆ„ÄéLAUTRIV„Äè„Åï„Çì„ÅÆÂá∫Êºî„ÅåÊ±∫ÂÆö„Åó„Åæ„Åó„Åü„ÉºÔºÅÔºÅÔºÅ' },
                { char: 'penguin', text: '„Åà„Åà„ÅàÔºÅÔºüVo.Coco„Åï„Çì„ÄÅGt.Á©∫‰Ωç„Åï„Çì„ÄÅBa.„Å™„Åπ„ÅÇ„Åç„Åï„Çì„ÄÅDr.GINKO„Åï„Çì„ÅÆ„ÅÑ„Çã„ÅÇ„ÅÆ‚Ä¶ÔºÅÔºü„Åô„ÄÅ„Åô„Åî„ÅÑ„Åß„Åô‚Ä¶ÔºÅ' },
                { 
                    char: 'susukinitsuki', 
                    text: '„Çè„ÄÅË±™ËèØÔºÅ„Å©„Çì„Å©„Çì„Åô„Åî„ÅÑ„Åì„Å®„Å´„Å™„Å£„Å¶„ÅÑ„Åè„Å≠ÔºÅ',
                    choices: [
                        { text: '„Çµ„Éó„É©„Ç§„Ç∫„Åô„Åé„ÇãÔºÅ', next: 'ep4_continue' },
                        { text: '„Éï„Çß„Çπ„Åå„Å©„Çì„Å©„ÇìË±™ËèØ„Å´„Å™„ÇãÔºÅ', next: 'ep4_continue' }
                    ]
                },
            ],
            ep5_script: [
                { char: 'susukinitsuki', text: 'Èü≥Ê•Ω„ÅØ„Åô„Åî„ÅÑ„Åì„Å®„Å´„Å™„Å£„Å¶„Åç„Åü„Åë„Å©„ÄÅÊºîÂäá„Éë„Éº„Éà„ÇÇË≤†„Åë„Å¶„Çâ„Çå„Å™„ÅÑ„Çà„Å≠„ÄÇ' },
                { char: 'oto', text: '„Åµ„Åµ„Åµ‚Ä¶ÂÆü„ÅØ„ÄÅ„Å™„Çì„Å†„ÅãÂ§è„Å´ÂøÉÊÆã„Çä„Åå„ÅÇ„Çä„Åù„ÅÜ„Å™‰∫∫„Åü„Å°„ÇíÈÄ£„Çå„Å¶„Åç„Åü„ÇàÔºÅÈ†º„ÇÇ„Åó„ÅÑ‰ª≤Èñì„Åü„Å°„Åß„ÅôÔºÅ' },
                { char: 'system', text: '„Åä„Å®„Å°„ÇÉ„Çì„ÅåÂü∑‰∫ã„Åë„Åë„Åï„Çì„ÄÅÈ≠îÂ•≥„Éí„Éä„Éü„Ç£„Åï„Çì„ÄÅKA–ØMA„Åï„Çì„ÄÅ„Ç®„É¨„É≥„Åï„Çì„ÄÅË≤¥Â≥∂Á§ºÁØÄ„Åï„Çì„ÄÅÈáëÂ∞æ„Åï„Çì„ÄÅÁê¥Êúõ„Åï„Çì„ÄÅnagisa„Åï„Çì„ÇíÊãõÂæÖ„Åó„Åæ„Åó„Åü„ÄÇ' },
                { char: 'system', text: 'Ôºà8‰∫∫Ôºâ„ÅåÂèÇÂä†„Åó„Åæ„Åó„Åü„ÄÇ' },
                { char: 'keke', text: '„ÅäÂàù„Å´„ÅäÁõÆ„Å´„Åã„Åã„Çä„Åæ„Åô„ÄÇ„Åä„Å®„Åï„Çì„Å´„ÅäË™ò„ÅÑ„ÅÑ„Åü„Å†„Åç„ÄÅÂèÇ‰∏ä„Åó„Åæ„Åó„Åü„ÄÇ„Åì„ÅÆÂ§è„ÄÅ„Å©„ÅÜ„Å´„ÇÇ„ÇÑ„ÇäÊÆã„Åó„Åü„Åì„Å®„Åå„ÅÇ„ÇãËÄÖ„Åü„Å°„Åß„Åô„ÄÇ' },
                { 
                    char: 'yui', 
                    text: '„Çè„ÉºÔºÅ‰∏ÄÊ∞ó„Å´Ë≥ë„ÇÑ„Åã„Å´„Å™„Å£„ÅüÔºÅ„Çà„ÅÜ„Åì„ÅùÔºÅ',
                    choices: [
                        { text: '„Åô„Åî„ÅÑÔºÅÂøÉÂº∑„ÅÑÔºÅ', next: 'ep5_continue' },
                        { text: '‰∏ÄÁ∑í„Å´ÊúÄÈ´ò„ÅÆÂ§è„Å´„Åó„Çà„ÅÜÔºÅ', next: 'ep5_continue' }
                    ]
                },
            ],
            ep6_script: [
                { char: 'kawashii', text: '„Çπ„ÉÜ„Éº„Ç∏Ë£ÖÈ£æ„ÄÅÊúÄÁµÇË™øÊï¥ÂÆå‰∫ÜÔºÅ„Éâ„Ç´„É≥„Å®Ê¥æÊâã„Å´„ÅÑ„Åè„ÅúÔºÅ' },
                { char: 'system', text: '„Åã„Çè„Åó„ÅÉ„ÅåÂÜôÁúü„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü„ÄÇ' },
                { char: 'kabochashinshi', text: 'Ë¶ã„Å¶„Åè„Çå„ÄÅ„Åì„ÅÆËºù„Åè„Ç¢„ÇØ„Çª„Çµ„É™„Éº„Åü„Å°„ÇíÔºÅÈùíÊò•„ÅÆÊÄù„ÅÑÂá∫‰Ωú„Çä„Å´„Åú„Å≤ÔºÅ' },
                { char: 'system', text: '„Ç´„Éú„ÉÅ„É£Á¥≥Â£´„ÅåÂÜôÁúü„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü„ÄÇ' },
                { char: 'motoji', text: '„Ç´„É°„É©„ÇÇ„É¨„É≥„Ç∫„ÇÇÊ∫ñÂÇô‰∏áÁ´ØÔºÅ„Åø„Çì„Å™„ÅÆÊúÄÈ´ò„ÅÆË°®ÊÉÖ„ÄÅÂæÖ„Å£„Å¶„Çã„ÇàÔºÅ' },
                { char: 'penguin', text: 'Ë≠¶ÂÇô„É´„Éº„Éà„ÄÅÊúÄÁµÇÁ¢∫Ë™ç„Åó„Åæ„Åó„ÅüÔºÅÁöÜ„Åï„Çì„ÅÆÂÆâÂÖ®„ÅØ„Ç¶„ÉÅ„ÅåÂÆà„Çä„Åæ„ÅôÔºÅ' },
                { char: 'kagekin', text: '„Éï„Éï„Éï‚Ä¶„Éü„Éº„ÅØ„Å§„ÅÑ„Å´ÂÆåÊàê„Åï„Åõ„Åü„ÅûÔºÅÂ§è„ÇíÁµÇ„Çè„Çâ„Åõ„Çã„ÅÆ„Åß„ÅØ„Å™„Åè„ÄÅÂ§è„Åù„ÅÆ„ÇÇ„ÅÆ„ÇíÊâìÂÄí„Åô„Çã„Åü„ÇÅ„ÅÆÊúÄÁµÇÂÖµÂô®„ÄÅ‰∏ñÁïå„ÇØ„Éº„É©„Éº„ÇíÔºÅ' },
                { 
                    char: 'yui', 
                    text: '„Åà„ÅáÔºÅÔºü„Å™„Å´„Åù„ÇåÔºÅÔºü',
                    choices: [
                        { text: 'Â§è„ÇíÂÄí„Åï„Å™„ÅÑ„ÅßÔºÅ', next: 'ep6_continue' },
                        { text: 'Èù¢ÁôΩ„Åù„ÅÜ„Å†„Åã„ÇâË¶ã„Åü„ÅÑ„Åã„ÇÇ‚Ä¶', next: 'ep6_continue' }
                    ]
                },
            ]
        };

        const storyBranches = {
            emo_choice: [
                { char: 'yui', text: '„Åï„Çì„Åõ„Éº„ÅÑÔºÅÂ§ïÊöÆ„Çå„ÅÆÂÖâ„Å´ÂèçÂ∞Ñ„Åó„Å¶„ÄÅÁµ∂ÂØæ„Ç≠„É¨„Ç§„Å†„ÇàÔºÅ' },
                { char: 'kabochashinshi', text: '„Ç®„É¢„ÅÑ„ÅØÊ≠£Áæ©ÔºÅ„Åù„ÅÜ„ÅÑ„ÅÜÈõ∞Âõ≤Ê∞ó„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÅØ„Çà„ÅèÂ£≤„Çå„Çã„Çì„Å†„ÄÅÁßÅ„ÅÆÁµåÈ®ì‰∏ä„Å≠ÔºÅ' },
                { char: 'kawashii', text: '„Ç®„É¢„ÅÑÁàÜÁô∫„ÇÇ„ÅäÊâã„ÅÆÁâ©„Å†„Åú„ÄÇ‰ªª„Åõ„Å™ÔºÅ' },
                { char: 'oto', text: '„Çà„Åó„ÄÅ„Ç≠„É©„Ç≠„É©„Ç®„É¢Ë∑ØÁ∑ö„Åß„ÅÑ„Åì„ÅÜÔºÅ„Åò„ÇÉ„ÅÇÊ¨°„ÅØ„ÄÅ„Éï„Çß„Çπ„Åß„ÇÑ„Çä„Åü„ÅÑ„Åì„Å®„Å™„Çì„Å†„Åë„Å©‚Ä¶' },
                { char: 'oto', text: '„É®„Ç§„ÇΩ„É©È´òÊ†°„Å®„ÅÑ„Åà„Å∞„ÄÅ„ÇÑ„Å£„Å±„Çä‰∏É‰∏çÊÄùË≠∞„Å†„Çà„Å≠ÔºÅüëª', next: 'common_route' }
            ],
            base_choice: [
                { char: 'yui', text: 'ÁßòÂØÜÂü∫Âú∞ÔºÅ„ÅÑ„ÅÑ„Åò„ÇÉ„ÇìÔºÅÁßÅ„Åü„Å°„Å†„Åë„ÅÆÂ†¥ÊâÄ„Å£„Å¶ÊÑü„Åò„Åå„Åó„Å¶„ÉØ„ÇØ„ÉØ„ÇØ„Åô„ÇãÔºÅ' },
                { char: 'akira', text: '„Å™„Çã„Åª„Å©„ÄÇÊú®„ÅÆÊú∫„Å®„ÅãÊåÅ„Å°Ëæº„Çì„Åß„ÄÅ„Ç¢„Ç≥„Éº„Çπ„ÉÜ„Ç£„ÉÉ„ÇØ„Å™ÊºîÂ•è„ÇÇÊò†„Åà„Åù„ÅÜ„Å†„Å™„ÄÇ' },
                { char: 'oto', 'text': 'Ê±∫ÂÆöÔºÅ„Åø„Çì„Å™„Åß‰Ωú„Çä‰∏ä„Åí„ÇãÁßòÂØÜÂü∫Âú∞„Å´„Åó„Çà„ÅÜÔºÅ„Åò„ÇÉ„ÅÇÊ¨°„ÅØ„ÄÅ„Éï„Çß„Çπ„Åß„ÇÑ„Çä„Åü„ÅÑ„Åì„Å®„Å™„Çì„Å†„Åë„Å©‚Ä¶' },
                { char: 'oto', text: '„É®„Ç§„ÇΩ„É©È´òÊ†°„Å®„ÅÑ„Åà„Å∞„ÄÅ„ÇÑ„Å£„Å±„Çä‰∏É‰∏çÊÄùË≠∞„Å†„Çà„Å≠ÔºÅüëª', next: 'common_route' }
            ],
            rock_choice: [
                { char: 'akira', text: '„Åù„Çå„Å†„ÄÇ‰ºùË™¨„ÅÆËªΩÈü≥ÈÉ®„Åå„ÇÑ„Å£„Å¶„Åü„Åø„Åü„ÅÑ„Å´„ÄÅ„Ç¨„ÉÑ„É≥„Å®„É≠„ÉÉ„ÇØ„Å™„Çπ„ÉÜ„Éº„Ç∏„Å´„Åó„Åü„ÅÑ„ÄÇ' },
                { char: 'kawashii', text: '„É≠„ÉÉ„ÇØ„Å™„ÇâÊ¥æÊâã„Å™ÁâπÂäπ(„Éë„Ç§„É≠)„ÅØÂøÖÈ†à„Å†„Çç„ÅÜÔºÅ‰ø∫„ÅÆÂá∫Áï™„Å†„Å™ÔºÅÂÆâÂøÉ„Åó„Å¶„Åè„Çå„ÄÅÂ®ÅÂäõ„ÅØ„Å°„ÇÉ„Çì„Å®Ë™øÊï¥„Åô„Çã„Åã„ÇâÔºÅ‚Ä¶„Åü„Å∂„Çì„ÄÇ' },
                { char: 'oto', text: '„ÅÑ„ÅÑ„Å≠ÔºÅ‰ºùË™¨„ÅÆ„É≠„ÉÉ„ÇØ„Éï„Çß„Çπ„ÄÅÂÜçÁèæ„Åó„Å°„ÇÉ„Åä„ÅÜÔºÅ„Åò„ÇÉ„ÅÇÊ¨°„ÅØ„ÄÅ„Éï„Çß„Çπ„Åß„ÇÑ„Çä„Åü„ÅÑ„Åì„Å®„Å™„Çì„Å†„Åë„Å©‚Ä¶' },
                { char: 'oto', text: '„É®„Ç§„ÇΩ„É©È´òÊ†°„Å®„ÅÑ„Åà„Å∞„ÄÅ„ÇÑ„Å£„Å±„Çä‰∏É‰∏çÊÄùË≠∞„Å†„Çà„Å≠ÔºÅüëª', next: 'common_route' }
            ],
            common_route: [
                { char: 'yui', text: '‰∏É‰∏çÊÄùË≠∞ÔºÅ„Åù„ÅÜ„ÅÑ„Åà„Å∞„ÄÅÁæéË°ìÂÆ§„ÅÆÈè°„ÅßÂÜôÁúü„ÇíÊíÆ„Çã„Å®‰Ωï„Åã„ÅåÊò†„Çã„Å®„Åã„ÄÅÈü≥Ê•ΩÂÆ§„ÅÆ„Éî„Ç¢„Éé„ÅåÂãùÊâã„Å´È≥¥„Çã„Å®„Åã„ÄÅËâ≤„ÄÖÂôÇ„ÅÇ„Çã„Çà„Å≠‚Ä¶ÔºÅ' },
                { char: 'akira', text: 'ÁîüÂæí‰ºöÂÆ§„Å´‰ª£„ÄÖ‰ºù„Çè„Çã„Å£„Å¶„ÅÑ„ÅÜË¨é„ÅÆÁéâ„ÅÆË©±„ÇÇÊ∞ó„Å´„Å™„Çã„Å™„ÄÇ' },
                { char: 'motoji', text: 'ÁæéË°ìÂÆ§„Åß‰Ωï„Åã„ÅåÊò†„Çã‚Ä¶ÔºÅÔºü„Å™„Çì„Å¶„Åì„Å£„Åü„ÅÑ„ÄÅÊúÄÈ´ò„ÅÆ„Ç∑„É£„ÉÉ„Çø„Éº„ÉÅ„É£„É≥„Çπ„Åò„ÇÉ„Å™„ÅÑ„Åß„Åô„ÅãÔºÅ' },
                { char: 'kagekin', text: 'Ë¨é„ÅÆÁéâÔºÅ„Éõ„É©„Éº„Ç∑„Éß„Éº„Å†„Å≠„ÉºÔºÅ„Åù„Çå„ÇíÊâã„Å´ÂÖ•„Çå„Çå„Å∞„Éü„Éº„ÅÆÊîØÊåÅÁéá„ÇÇÁàÜ‰∏ä„Åå„Çä„Å†„Çà„ÉºÔºÅ„Éã„É£„Éº„Éã„É£„ÉºÔºÅ' },
                { char: 'oto', text: '„Åµ„Åµ„Åµ„ÄÅ„Åù„ÅÆÈÄö„ÇäÔºÅ‰ªäÂõû„ÅÆ„Éï„Çß„Çπ„ÅØ„ÄÅ„Åü„Å†„ÅÆ„É©„Ç§„Éñ„Å†„Åë„Åò„ÇÉ„Å™„ÅÑ„ÅÆ„ÄÇ„Åø„Çì„Å™„ÅßÊ†°Ëàé„ÇíÊé¢Á¥¢„Åó„Å¶„ÄÅ„É®„Ç§„ÇΩ„É©È´òÊ†°„ÅÆ‚ÄúË®òÊÜ∂‚Äù„Å´Ëß¶„Çå„ÇãÊôÇÈñì„ÇÇ‰Ωú„Çä„Åü„ÅÑ„Çì„Å†„ÄÇ' },
                {
                    char: 'oto',
                    text: '„Åø„Çì„Å™„ÇÇ„ÄÅ„Åì„ÅÆ‚ÄúÂÖ±ÁäØËÄÖ‚Äù„ÅÆ‰∏ÄÂì°„Å´„Å™„Å£„Å¶„Åè„Çå„ÇãÔºü',
                    choices: [
                        { text: '„ÇÇ„Å°„Çç„ÇìÔºÅÈù¢ÁôΩ„Åù„ÅÜÔºÅ', next: 'final_route' },
                        { text: 'ÊúÄÈ´ò„ÅÆÂ§è„Å´„Åó„Çà„ÅÜÔºÅ', next: 'final_route' }
                    ]
                }
            ],
            final_route: [
                { char: 'oto', text: '„ÅÇ„Çä„Åå„Å®„ÅÜÔºÅÂøÉÂº∑„ÅÑ„ÇàÔºÅ' },
                { char: 'yui', text: '„Åø„Çì„Å™„Åß„ÇÑ„Çå„Å∞„ÄÅÁµ∂ÂØæÊàêÂäü„Åô„Çã„ÇàÔºÅ' },
                { char: 'akira', text: '„ÅÇ„ÅÇ„ÄÇÂøò„Çå„Çâ„Çå„Å™„ÅÑ‰∏ÄÂ§ú„Å´„Åó„Å¶„ÇÑ„Çã„Åï„ÄÇ' },
                { char: 'kabochashinshi', text: '„Åì„Çå„ÅûÈùíÊò•‚Ä¶ÔºÅÁßÅ„ÇÇÂÖ®Âäõ„Åß„Çµ„Éù„Éº„Éà„Åï„Åõ„Å¶„ÇÇ„Çâ„ÅÜ„Çà„ÄÅ‰∏Ä‰∫∫„ÅÆ‚ÄúÁîüÂæí‚Äù„Å®„Åó„Å¶„Å≠ÔºÅ' },
                { char: 'oto', text: '„Åò„ÇÉ„ÅÇ„ÄÅ‰ΩúÊà¶‰ºöË≠∞„ÅØ„Åì„Åì„Åæ„ÅßÔºÅË©≥Á¥∞„ÅØ„Åæ„ÅüÈÄ£Áµ°„Åô„Çã„Å≠„ÄÇ9Êúà23Êó•„ÄÅ„É®„Ç§„ÇΩ„É©È´òÊ†°„ÅßÂæÖ„Å£„Å¶„ÇãÔºÅ #YOISORAFES', next: 'end_of_episode' },
            ],
            ep2_continue: [
                { char: 'oto', text: '„Çà„Åó„ÄÅ„Ç¶„ÉÅ„ÅåÈÄ£Áµ°„Åó„Å¶„Åø„ÇãÔºÅ„Åø„Çì„Å™„ÄÅÊàêÂäü„ÇíÁ•à„Å£„Å¶„Å¶ÔºÅ' },
                { char: 'system', text: 'ÔºàÊï∞ÊôÇÈñìÂæå‚Ä¶Ôºâ' },
                { char: 'oto', text: '„Åø„Çì„Å™„ÉºÔºÅSTRiNG5„Åï„Çì„ÄÅÂá∫ÊºîOK„Å†„Å£„Å¶ÔºÅ„ÇÑ„Å£„Åü„ÉºÔºÅÔºÅüéâ' },
                { char: 'kawashii', text: '„Åä„ÅäÔºÅ„ÇÑ„Å£„Åü„Å™ÔºÅ„Åì„Çå„ÅØÊ¥æÊâã„Å™„Çπ„ÉÜ„Éº„Ç∏„Å´„Åó„Åå„ÅÑ„Åå„ÅÇ„Çã„ÅúÔºÅ', next: 'end_of_episode' }
            ],
            ep3_continue: [
                { char: 'yui', text: '„Çè„ÄÅMVË¶ã„Åü„Åë„Å©„ÄÅGtVo.„ÅÆ„Åµ„ÅÅ„Çì„Åï„Çì„ÄÅÁÜ±„ÅÑ„Å≠ÔºÅÈùíÊò•„Å£„Å¶ÊÑü„ÅòÔºÅ„Åì„ÅÆMV„Å†„ÇàÔºÅ\nhttps://www.youtube.com/@phantom1552' },
                { char: 'motoji', text: '„ÅÜ„Åä„Åä„ÅäÔºÅÔºÅ ÁÜ±„ÅÑ„É≠„ÉÉ„ÇØ„Éê„É≥„Éâ„Å†„Å≠ÔºÅ „Åì„Çå„ÅØÊíÆ„Çã„Åó„Åã„Å™„ÅÑÔºÅ' },
                { char: 'oto', text: '„Åß„Åó„Çá„Åß„Åó„ÇáÔºÅ„Çà„Åó„ÄÅ„Åæ„Åü„Åæ„Åü„Ç¶„ÉÅ„Åå‰∫§Ê∏â„Åó„Å¶„Åè„ÇãÔºÅ' },
                { char: 'system', text: 'Ôºà„Åæ„ÅüÊï∞ÊôÇÈñìÂæå‚Ä¶Ôºâ' },
                { char: 'oto', text: 'PHANTOM„Åï„Çì„ÇÇÂá∫ÊºîÊ±∫ÂÆöÔºÅÂ•áË∑°„Å†‚Ä¶ÔºÅÊúÄÈ´ò„ÅÆÂ§è„Å´„Å™„Çã‰∫àÊÑü„Åó„Åã„Åó„Å™„ÅÑÔºÅ', next: 'end_of_episode' }
            ],
            ep4_continue: [
                { char: 'yui', text: 'Êú¨ÂΩì„Å´ÔºÅÔºüË±™ËèØ„Åô„Åé„ÇãÔºÅ' },
                { char: 'oto', text: '„ÅÜ„ÇìÔºÅ„Åì„Çì„Å™„Å´Á¥†Êïµ„Å™„Ç¢„Éº„ÉÜ„Ç£„Çπ„Éà„Åï„Çì„Åü„Å°„ÅåÈõÜ„Åæ„Å£„Å¶„Åè„Çå„Å¶‚Ä¶ÊúÄÈ´ò„ÅÆÊÄù„ÅÑÂá∫„Åå‰Ωú„Çå„Åù„ÅÜ„Å†„Å≠ÔºÅ', next: 'end_of_episode' }
            ],
            ep5_continue: [
                { char: 'penguin', text: '„Åô„Åî„ÅÑ‚Ä¶ÔºÅÊºîÂäá„ÅÆÊñπ„ÄÖ„Åæ„Åß‚Ä¶ÔºÅ„Ç¶„ÉÅ„ÄÅ„Å™„Çì„Å†„ÅãÊÑüÂãï„Åó„Å°„ÇÉ„ÅÑ„Åæ„Åó„Åü‚Ä¶ÔºÅ' },
                { char: 'akira', text: 'ÂøÉÊÆã„Çä„ÄÅ„Åã„ÄÇ„ÅÑ„ÅÑ„Åò„ÇÉ„Å™„ÅÑ„Åã„ÄÇ„Åì„ÅÆ„Éï„Çß„Çπ„ÅßÂÖ®ÈÉ®Êô¥„Çâ„Åó„Å¶„ÅÑ„Å£„Å¶„Åè„Çå„ÄÇ' },
                { char: 'oto', text: '„ÅÜ„ÇìÔºÅÊúÄÈ´ò„ÅÆÈùíÊò•„Çí„ÄÅ„Åì„ÅÆÂ≠¶Ê†°„Åß‰∏ÄÁ∑í„Å´‰Ωú„Çç„ÅÜ„Å≠ÔºÅ', next: 'end_of_episode' }
            ],
            ep6_continue: [
                { char: 'akira', text: '‚Ä¶„ÅÑ„ÇÑ„ÄÅÂ§è„ÅØÁµÇ„Çè„Çâ„Åõ„Åü„Åè„Å™„ÅÑ„Å†„Åë„Åß„ÄÅÂÄí„Åï„Å™„Åè„Å¶„ÅÑ„ÅÑ„Çì„Å†„Åå„ÄÇ' },
                { char: 'oto', text: '„ÇÇ„Éº„ÄÅ„Ç´„Ç≤„Ç≠„É≥„ÅØÔºÅ„Åß„ÇÇ„ÄÅ„Åø„Çì„Å™Ê∫ñÂÇô‰∏áÁ´Ø„Å†„Å≠ÔºÅ„ÅÑ„Çà„ÅÑ„Çà„Å†„Å≠ÔºÅ **9Êúà23Êó•„ÄÅ18:30„Å´Ê†°ÈñÄÂâçÈõÜÂêàÔºÅ** Áµ∂ÂØæ„Å´ÈÅÖ„Çå„Å™„ÅÑ„Åß„Å≠ÔºÅ' },
                { char: 'system', text: 'Ôºà„Åà„ÅÑ„Åà„ÅÑ„Åä„ÉºÔºÅ„ÅÆ„Çπ„Çø„É≥„Éó„ÅåÈ£õ„Å≥‰∫§„ÅÜÔºâ', next: 'end_of_episode' }
            ],
            end_of_episode: [
                { char: 'system', text: 'To be continued...', next: 'show_logo' }
            ],
            show_logo: [
                { char: 'logo' },
                { char: 'final_message' }
            ]
        };

        let currentEpisodeId = 1;
        let currentScript = scripts.ep1_script;
        let soundReady = false;
        let allEpisodesUnlocked = false;
        let isScriptPlaying = false;
        let playbackId = 0;


        document.body.addEventListener('click', () => {
            if (!soundReady) {
                Tone.start();
                soundReady = true;
            }
        }, { once: true });

        function createExplosion(element) {
            if (!soundReady) return;
            const noise = new Tone.NoiseSynth({ noise: { type: 'white' }, envelope: { attack: 0.005, decay: 0.2, sustain: 0.1, release: 0.2 } }).toDestination();
            noise.volume.value = -18;
            const synth = new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.01, decay: 0.3, sustain: 0, release: 0.2 } }).toDestination();
            synth.volume.value = -18;
            noise.triggerAttackRelease("8n");
            synth.triggerAttackRelease("C2", "8n", Tone.now() + 0.05);
            const emojis = ['üí•', 'üî•', '‚ú®', 'üí£', 'üí®'];
            const rect = element.getBoundingClientRect();
            const originX = rect.left + rect.width / 2;
            const originY = rect.top + rect.height / 2;
            for (let i = 0; i < 25; i++) {
                const emoji = document.createElement('div');
                emoji.className = 'explosion-emoji';
                emoji.innerText = emojis[Math.floor(Math.random() * emojis.length)];
                document.body.appendChild(emoji);
                gsap.set(emoji, { left: originX, top: originY });
                gsap.to(emoji, { x: (Math.random() - 0.5) * 300, y: (Math.random() - 0.5) * 300, opacity: 0, rotation: Math.random() * 720, duration: Math.random() * 1 + 0.5, ease: "power2.out", onComplete: () => emoji.remove() });
            }
        }

        function addMessage(char, text, localPlaybackId) {
            return new Promise(resolve => {
                setTimeout(() => {
                    if (playbackId !== localPlaybackId) return;
                    const character = characters[char];
                    const messageWrapper = document.createElement('div');
                    messageWrapper.className = 'flex items-start gap-3 fade-in';
                    const avatar = document.createElement('img');
                    avatar.src = character.avatar;
                    avatar.alt = character.name;
                    avatar.className = 'w-10 h-10 rounded-full shadow-md object-cover';
                    avatar.onerror = () => { avatar.src = 'https://placehold.co/40x40/cccccc/ffffff?text=?'; };
                    const messageContent = document.createElement('div');
                    const name = document.createElement('div');
                    name.className = 'text-sm text-gray-300 font-bold';
                    name.textContent = character.name;
                    const bubble = document.createElement('div');
                    bubble.className = 'chat-bubble chat-bubble-left relative mt-1 bg-white text-gray-800 p-3 rounded-lg rounded-tl-none shadow-md max-w-xs break-words';
                    
                    const urlRegex = /(https?:\/\/[^\s]+)/g;
                    const parts = text.split(urlRegex);

                    parts.forEach(part => {
                        if (part.match(urlRegex)) {
                            const link = document.createElement('a');
                            link.href = part;
                            link.target = '_blank';
                            link.className = 'text-blue-600 hover:underline';
                            link.textContent = part;
                            bubble.appendChild(link);
                        } else {
                            bubble.appendChild(document.createTextNode(part));
                        }
                    });

                    if (char === 'kawashii') {
                        bubble.style.cursor = 'pointer';
                        bubble.addEventListener('click', () => createExplosion(bubble));
                    }
                    messageContent.appendChild(name);
                    messageContent.appendChild(bubble);
                    messageWrapper.appendChild(avatar);
                    messageWrapper.appendChild(messageContent);
                    chatArea.appendChild(messageWrapper);
                    chatArea.scrollTop = chatArea.scrollHeight;
                    resolve();
                }, Math.random() * 2000 + 2000);
            });
        }
        
        function addSystemMessage(text, localPlaybackId) {
             return new Promise(resolve => {
                setTimeout(() => {
                    if (playbackId !== localPlaybackId) return;
                    const messageWrapper = document.createElement('div');
                    messageWrapper.className = 'text-center text-sm text-purple-300 py-2 fade-in';
                    messageWrapper.textContent = text;
                    chatArea.appendChild(messageWrapper);
                    chatArea.scrollTop = chatArea.scrollHeight;
                    resolve();
                }, 1000);
             });
        }

        function showLogo(localPlaybackId) {
            return new Promise(resolve => {
                setTimeout(() => {
                    if (playbackId !== localPlaybackId) return;
                    const logoContainer = document.createElement('div');
                    logoContainer.className = 'text-center mt-4 fade-in';
                    const logoLink = document.createElement('a');
                    logoLink.href = 'https://yoisorafes.studio.site/';
                    logoLink.target = '_blank';
                    const logoImg = document.createElement('img');
                    logoImg.src = 'https://i.imgur.com/CFch2EA.png';
                    logoImg.alt = 'Yoisora Fes Logo';
                    logoImg.className = 'mx-auto max-w-xs';
                    logoLink.appendChild(logoImg);
                    logoContainer.appendChild(logoLink);
                    chatArea.appendChild(logoContainer);
                    chatArea.scrollTop = chatArea.scrollHeight;
                    resolve();
                }, 1000);
            });
        }
        
        function addFinalMessage(localPlaybackId) {
            return addMessage('oto', '„Éï„Çß„Çπ„ÅÆÊúÄÊñ∞ÊÉÖÂ†±„ÇÑ„Ç∞„ÉÉ„Ç∫„ÅÆ„Åì„Å®„ÅØ„ÄÅÂÖ¨Âºè„Çµ„Ç§„Éà„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Å¶„Å≠ÔºÅ\nhttps://yoisorafes.studio.site/', localPlaybackId);
        }

        function showChoices(choices) {
            choicesContainer.innerHTML = '';
            choiceArea.classList.remove('opacity-0');
            choices.forEach(choice => {
                const button = document.createElement('button');
                button.className = 'w-full bg-purple-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-purple-700 transition-all duration-200 shadow-lg transform hover:scale-105';
                button.textContent = choice.text;
                button.onclick = () => handleChoice(choice.next);
                choicesContainer.appendChild(button);
            });
        }

        async function handleChoice(nextBranchKey) {
            if (isScriptPlaying) return;

            choicesContainer.innerHTML = '';
            const userChoiceText = event.target.textContent;
            const userMessageWrapper = document.createElement('div');
            userMessageWrapper.className = 'flex items-start gap-3 fade-in justify-end';
            const bubble = document.createElement('div');
            bubble.className = 'relative mt-1 bg-purple-500 text-white p-3 rounded-lg rounded-br-none shadow-md max-w-xs';
            bubble.textContent = userChoiceText;
            userMessageWrapper.appendChild(bubble);
            chatArea.appendChild(userMessageWrapper);
            chatArea.scrollTop = chatArea.scrollHeight;
            
            currentScript = storyBranches[nextBranchKey];
            await playCurrentScript(playbackId);
        }

        async function playCurrentScript(localPlaybackId) {
            if (playbackId !== localPlaybackId) return;
            
            isScriptPlaying = true;
            renderEpisodes();

            for (const line of currentScript) {
                if (playbackId !== localPlaybackId) return;

                if (line.char === 'system') {
                    await addSystemMessage(line.text, localPlaybackId);
                } else if (line.char === 'logo') {
                    await showLogo(localPlaybackId);
                } else if (line.char === 'final_message') {
                    await addFinalMessage(localPlaybackId);
                } else {
                    await addMessage(line.char, line.text, localPlaybackId);
                }

                if (playbackId !== localPlaybackId) return;

                if (line.choices) {
                    isScriptPlaying = false;
                    renderEpisodes();
                    showChoices(line.choices);
                    return;
                }
                if (line.next) {
                    currentScript = storyBranches[line.next];
                    await playCurrentScript(localPlaybackId);
                    return;
                }
            }
            
            isScriptPlaying = false;
            renderEpisodes();
        }

        async function loadEpisode(episode) {
            if (isScriptPlaying && currentEpisodeId === episode.id) return;
            if (!scripts[episode.script]) return;

            playbackId++;
            currentEpisodeId = episode.id;
            currentScript = scripts[episode.script];
            
            chatArea.innerHTML = '';
            choicesContainer.innerHTML = '';

            await playCurrentScript(playbackId);
        }
        
        // Episode Navigation Logic
        function getCurrentDate() {
            return new Date();
        }

        function renderEpisodes() {
            const now = getCurrentDate();
            episodeListContainer.innerHTML = '';
            episodes.forEach(episode => {
                const releaseDate = new Date(episode.releaseDate + 'T00:00:00+09:00');
                const isUnlocked = allEpisodesUnlocked || now >= releaseDate;
                
                const episodeElement = document.createElement('a');
                
                let content;
                if (isUnlocked) {
                    episodeElement.href = '#';
                    if(scripts[episode.script]) {
                        episodeElement.onclick = (e) => {
                            e.preventDefault();
                            loadEpisode(episode);
                        };
                    }

                    content = `
                        <div class="text-sm break-words">${episode.title}</div>
                        <div class="text-xs text-green-400">ÂÖ¨Èñã‰∏≠</div>
                    `;
                    episodeElement.className = `block w-full p-3 rounded-lg bg-slate-700/80 hover:bg-slate-600/80 transition ${episode.id === currentEpisodeId ? 'ring-2 ring-pink-500' : ''}`;
                    if(!scripts[episode.script] || (isScriptPlaying && currentEpisodeId === episode.id)) {
                        episodeElement.className += ' opacity-50 cursor-wait';
                    }
                } else {
                    episodeElement.href = '#';
                    content = `
                        <div class="text-sm text-gray-500 break-words">ÔºüÔºüÔºüÔºüÔºüÔºü</div>
                        <div class="text-xs text-gray-400">${releaseDate.getMonth() + 1}/${releaseDate.getDate()} ÂÖ¨Èñã‰∫àÂÆö</div>
                    `;
                    episodeElement.className = 'block w-full p-3 rounded-lg bg-slate-900/50 cursor-not-allowed';
                }
                
                episodeElement.innerHTML = `<div class="text-white">${content}</div>`;
                episodeListContainer.appendChild(episodeElement);
            });
        }


        // Modal and Share Button Logic
        openModalButton.addEventListener('click', () => profileModal.classList.remove('hidden'));
        closeModalButton.addEventListener('click', () => profileModal.classList.add('hidden'));
        profileModal.addEventListener('click', (e) => {
            if (e.target === profileModal) {
                profileModal.classList.add('hidden');
            }
        });
        
        // Secret debug button logic
        secretButton.addEventListener('click', () => {
            allEpisodesUnlocked = true;
            renderEpisodes();
            alert('ÂÖ®„Ç®„Éî„ÇΩ„Éº„Éâ„ÅåÈñãÊîæ„Åï„Çå„Åæ„Åó„ÅüÔºÅ');
            profileModal.classList.add('hidden');
        });
        
        // Mobile Episode Panel Toggle
        episodeToggleButton.addEventListener('click', () => {
            sidePanelContainer.classList.toggle('hidden');
        });


        function shareOnX() {
            const text = encodeURIComponent("YOISORA FES 2025 ‰ΩúÊà¶‰ºöË≠∞„Å´ÂèÇÂä†„Åó„Çà„ÅÜÔºÅ #YOISORAFES");
            const url = encodeURIComponent('https://yoisorafes.studio.site/');
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
        }

        window.onload = () => {
            const firstEpisode = episodes.find(ep => ep.id === 1);
            if(firstEpisode) {
                loadEpisode(firstEpisode);
            }
            renderEpisodes();
        };
    </script>
</body>
</html>
